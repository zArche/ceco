# coding=utf8

import matplotlib.pyplot as plt
import sys

from configs import PROJECT_DIR
from data_source.tushare.stock import get_sh_last_12_month_stock_exponential_changes, \
    get_sz_last_12_month_stock_exponential_changes

reload(sys)
sys.setdefaultencoding("utf-8")
sys.path.append("..")

plt.rcParams['savefig.dpi'] = 150  # 图片像素 
plt.rcParams['figure.dpi'] = 150  # 分辨率

OUT_PUT_DIR = PROJECT_DIR + "/output/"

MONEY_FLOW = [
    "2019-05-10,179.1464,2.95%,170.9995,2.82%,8.1469,0.13%,-101.457,-1.67%,-77.6894,-1.28%,2939.21,3.10%,9235.39,4.03%",
    "2019-05-13,-321.074,-6.97%,-134.9311,-2.93%,-186.1428,-4.04%,37.8517,0.82%,283.2223,6.15%,2903.71,-1.21%,9103.36,-1.43%",
    "2019-05-14,-118.1986,-2.61%,-15.7921,-0.35%,-102.4065,-2.26%,-19.5474,-0.43%,137.746,3.04%,2883.61,-0.69%,9038.36,-0.71%",
    "2019-05-15,94.9612,1.87%,113.6284,2.23%,-18.6671,-0.37%,-65.8711,-1.29%,-29.0902,-0.57%,2938.68,1.91%,9259.03,2.44%",
    "2019-05-16,-148.4957,-2.86%,-46.379,-0.89%,-102.1167,-1.97%,-4.3226,-0.08%,152.8184,2.94%,2955.71,0.58%,9293.32,0.37%",
    "2019-05-17,-406.9726,-7.13%,-154.2609,-2.7%,-252.7117,-4.43%,30.1876,0.53%,376.7849,6.6%,2882.30,-2.48%,9000.19,-3.15%",
    "2019-05-20,-160.9968,-3.49%,-40.3222,-0.88%,-120.6746,-2.62%,-12.403,-0.27%,173.3998,3.76%,2870.60,-0.41%,8916.11,-0.93%",
    "2019-05-21,48.1428,1.01%,71.6782,1.5%,-23.5353,-0.49%,-46.4753,-0.97%,-1.6675,-0.03%,2905.97,1.23%,9087.52,1.92%",
    "2019-05-22,-156.39,-3.35%,-42.473,-0.91%,-113.9169,-2.44%,-18.2666,-0.39%,174.6566,3.74%,2891.70,-0.49%,9041.22,-0.51%",
    "2019-05-23,-301.7913,-6.52%,-122.6992,-2.65%,-179.0921,-3.87%,8.031,0.17%,293.7603,6.35%,2852.52,-1.35%,8809.53,-2.56%",
    "2019-05-24,-115.817,-3.05%,-19.2222,-0.51%,-96.5948,-2.54%,-32.1859,-0.85%,148.0029,3.9%,2852.99,0.02%,8776.77,-0.37%",
    "2019-05-27,65.3692,1.44%,68.9183,1.52%,-3.5491,-0.08%,-48.8385,-1.08%,-16.5306,-0.36%,2892.38,1.38%,8979.83,2.31%",
    "2019-05-28,-95.1428,-1.95%,-4.4778,-0.09%,-90.665,-1.86%,-12.7941,-0.26%,107.9369,2.21%,2909.91,0.61%,9035.69,0.62%",
    "2019-05-29,-42.2438,-0.96%,32.8668,0.75%,-75.1106,-1.71%,-35.4055,-0.8%,77.6492,1.77%,2914.70,0.16%,9010.36,-0.28%",
    "2019-05-30,-225.7267,-5.04%,-79.0818,-1.76%,-146.6449,-3.27%,9.6114,0.21%,216.1153,4.82%,2905.81,-0.31%,8943.35,-0.74%",
    "2019-05-31,-83.7242,-1.94%,4.1765,0.1%,-87.9006,-2.04%,-28.4201,-0.66%,112.1443,2.6%,2898.70,-0.24%,8922.69,-0.23%",
    "2019-06-03,-214.7324,-4.53%,-54.3962,-1.15%,-160.3362,-3.39%,-16.6371,-0.35%,231.3695,4.89%,2890.08,-0.30%,8856.99,-0.74%",
    "2019-06-04,-254.1286,-6.05%,-97.6196,-2.32%,-156.509,-3.73%,3.8293,0.09%,250.2993,5.96%,2862.28,-0.96%,8748.27,-1.23%",
    "2019-06-05,-79.2455,-1.97%,5.6974,0.14%,-84.9429,-2.11%,-26.7872,-0.67%,106.0327,2.63%,2861.42,-0.03%,8746.05,-0.03%",
    "2019-06-06,-244.3155,-6.37%,-86.5777,-2.26%,-157.7378,-4.11%,-5.2093,-0.14%,249.5248,6.51%,2827.80,-1.17%,8584.94,-1.84%",
    "2019-06-10,1.7056,0.05%,37.0046,1.02%,-35.299,-0.97%,-38.7792,-1.06%,37.0736,1.02%,2852.13,0.86%,8711.79,1.48%",
    "2019-06-11,232.7269,4.13%,203.6528,3.61%,29.0742,0.52%,-122.6855,-2.18%,-110.0413,-1.95%,2925.72,2.58%,9037.67,3.74%",
    "2019-06-12,-201.6794,-3.97%,-61.2247,-1.21%,-140.4547,-2.77%,13.1905,0.26%,188.489,3.71%,2909.38,-0.56%,8954.72,-0.92%",
    "2019-06-13,-122.3119,-2.74%,-36.7774,-0.83%,-85.5345,-1.92%,-0.6088,-0.01%,122.9207,2.76%,2910.74,0.05%,8951.61,-0.03%",
    "2019-06-14,-263.7065,-5.93%,-101.0116,-2.27%,-162.6949,-3.66%,6.0316,0.14%,257.675,5.79%,2881.97,-0.99%,8810.13,-1.58%",
    "2019-06-17,-129.5632,-3.87%,-34.2544,-1.02%,-95.3088,-2.84%,-13.7961,-0.41%,143.3592,4.28%,2887.62,0.20%,8780.87,-0.33%",
    "2019-06-18,-79.683,-2.48%,-14.1303,-0.44%,-65.5527,-2.04%,-16.1544,-0.5%,95.8374,2.98%,2890.16,0.09%,8804.32,0.27%",
    "2019-06-19,59.2173,1.19%,71.1682,1.43%,-11.951,-0.24%,-77.3965,-1.56%,18.1792,0.37%,2917.80,0.96%,8925.73,1.38%",
    "2019-06-20,107.7354,1.79%,163.4545,2.72%,-55.7191,-0.93%,-128.3,-2.13%,20.5646,0.34%,2987.12,2.38%,9134.96,2.34%",
    "2019-06-21,-85.8408,-1.4%,-3.3076,-0.05%,-82.5332,-1.34%,-37.0877,-0.6%,122.9285,2%,3001.98,0.50%,9214.27,0.87%",
    "2019-06-24,-203.2312,-4.12%,-66.8275,-1.35%,-136.4037,-2.77%,8.671,0.18%,194.5602,3.94%,3008.15,0.21%,9212.12,-0.02%",
    "2019-06-25,-293.7792,-5.74%,-128.2397,-2.51%,-165.5395,-3.23%,26.5349,0.52%,267.2444,5.22%,2982.07,-0.87%,9118.10,-1.02%",
    "2019-06-26,-109.1521,-2.8%,-30.63,-0.79%,-78.5221,-2.02%,-16.6203,-0.43%,125.7724,3.23%,2976.28,-0.19%,9122.43,0.05%",
    "2019-06-27,-24.1673,-0.51%,45.4362,0.95%,-69.6035,-1.46%,-49.231,-1.03%,73.3983,1.54%,2996.79,0.69%,9239.48,1.28%",
    "2019-06-28,-239.8647,-5.8%,-75.9156,-1.84%,-163.949,-3.97%,-11.5631,-0.28%,251.4278,6.08%,2978.88,-0.60%,9178.31,-0.66%",
    "2019-07-01,350.6233,10.81%,231.8138,7.15%,118.8095,3.66%,73.9532,2.28%,30.4338,0.94%,3044.90,2.22%,9530.46,3.84%",
    "2019-07-02,-196.5922,-3.68%,-83.2225,-1.56%,-113.3697,-2.12%,31.1286,0.58%,165.4636,3.1%,3043.94,-0.03%,9545.52,0.16%",
    "2019-07-03,-271.0297,-5.58%,-114.5465,-2.36%,-156.4832,-3.22%,27.7097,0.57%,243.3201,5.01%,3015.26,-0.94%,9419.84,-1.32%",
    "2019-07-04,-182.1284,-4.17%,-64.0508,-1.47%,-118.0776,-2.71%,-6.8524,-0.16%,188.9808,4.33%,3005.25,-0.33%,9368.30,-0.55%",
    "2019-07-05,-46.2801,-1.25%,19.9487,0.54%,-66.2288,-1.79%,-33.7257,-0.91%,80.0057,2.16%,3011.06,0.19%,9443.22,0.80%",
    "2019-07-08,-354.3193,-7.64%,-136.3788,-2.94%,-217.9406,-4.7%,21.3868,0.46%,332.9326,7.18%,2933.36,-2.58%,9186.29,-2.72%",
    "2019-07-09,-125.169,-3.57%,-51.3116,-1.46%,-73.8574,-2.11%,3.5301,0.1%,121.6389,3.47%,2928.23,-0.17%,9198.79,0.14%",
    "2019-07-10,-130.1684,-3.98%,-44.0815,-1.35%,-86.0869,-2.63%,-4.793,-0.15%,134.9614,4.13%,2915.30,-0.44%,9166.15,-0.35%",
    "2019-07-11,-116.5413,-3.32%,-38.5778,-1.1%,-77.9635,-2.22%,-8.1597,-0.23%,124.701,3.55%,2917.76,0.08%,9152.77,-0.15%",
    "2019-07-12,-20.1065,-0.59%,24.9276,0.74%,-45.034,-1.33%,-37.0849,-1.09%,57.1913,1.69%,2930.55,0.44%,9213.38,0.66%",
    "2019-07-15,-8.1338,-0.19%,34.8055,0.81%,-42.9393,-1%,-44.2713,-1.04%,52.4051,1.23%,2942.19,0.40%,9309.42,1.04%",
    "2019-07-16,-95.2783,-2.73%,-16.2236,-0.46%,-79.0547,-2.26%,-14.7822,-0.42%,110.0605,3.15%,2937.62,-0.16%,9283.41,-0.28%",
    "2019-07-17,-69.7111,-1.84%,0.2589,0.01%,-69.97,-1.84%,-21.7039,-0.57%,91.415,2.41%,2931.69,-0.20%,9302.00,0.20%",
    "2019-07-18,-210.3867,-5.76%,-79.9979,-2.19%,-130.3888,-3.57%,3.094,0.08%,207.2927,5.68%,2901.18,-1.04%,9154.65,-1.58%",
    "2019-07-19,-70.6829,-2.01%,4.855,0.14%,-75.5379,-2.15%,-33.6624,-0.96%,104.3453,2.96%,2924.20,0.79%,9228.55,0.81%",
    "2019-07-22,-223.0327,-6.07%,-47.5346,-1.29%,-175.4981,-4.77%,-21.6954,-0.59%,244.7281,6.66%,2886.97,-1.27%,9122.64,-1.15%",
    "2019-07-23,-30.8094,-1.01%,-3.1568,-0.1%,-27.6526,-0.91%,-21.676,-0.71%,52.4854,1.72%,2899.94,0.45%,9175.83,0.58%",
    "2019-07-24,44.8233,1.16%,64.0664,1.66%,-19.2431,-0.5%,-50.2366,-1.3%,5.4132,0.14%,2923.28,0.80%,9266.30,0.99%",
    "2019-07-25,-6.8921,-0.19%,44.807,1.21%,-51.6992,-1.4%,-47.253,-1.28%,54.1451,1.47%,2937.36,0.48%,9344.82,0.85%",
    "2019-07-26,-55.8265,-1.69%,1.0859,0.03%,-56.9124,-1.72%,-29.6069,-0.89%,85.4334,2.58%,2944.54,0.24%,9349.00,0.04%",
    "2019-07-29,-93.6524,-2.88%,-22.2255,-0.68%,-71.4269,-2.2%,-13.5637,-0.42%,107.2161,3.3%,2941.01,-0.12%,9354.28,0.06%",
    "2019-07-30,-69.8858,-1.95%,-12.7781,-0.36%,-57.1077,-1.59%,-30.5488,-0.85%,100.4346,2.8%,2952.34,0.39%,9399.10,0.48%",
    "2019-07-31,-153.1335,-4.63%,-60.0421,-1.82%,-93.0914,-2.82%,-10.8776,-0.33%,164.0111,4.96%,2932.51,-0.67%,9326.61,-0.77%",
    "2019-08-01,-156.2051,-4.56%,-50.718,-1.48%,-105.4871,-3.08%,-6.0501,-0.18%,162.2552,4.73%,2908.77,-0.81%,9268.05,-0.63%",
    "2019-08-02,-206.0255,-5.07%,-68.7069,-1.69%,-137.3187,-3.38%,-13.085,-0.32%,219.1105,5.39%,2867.84,-1.41%,9136.46,-1.42%",
    "2019-08-05,-184.3953,-4.86%,-67.2837,-1.78%,-117.1115,-3.09%,-3.2041,-0.08%,187.5994,4.95%,2821.50,-1.62%,8984.73,-1.66%",
    "2019-08-06,-213.2793,-4.46%,-58.5051,-1.22%,-154.7742,-3.23%,-25.1204,-0.52%,238.3996,4.98%,2777.56,-1.56%,8859.47,-1.39%",
    "2019-08-07,-130.0249,-3.74%,-39.4806,-1.14%,-90.5443,-2.6%,-6.9202,-0.2%,136.9451,3.94%,2768.68,-0.32%,8814.74,-0.50%",
    "2019-08-08,-18.938,-0.56%,22.0033,0.66%,-40.9413,-1.22%,-25.9235,-0.77%,44.8616,1.34%,2794.55,0.93%,8919.28,1.19%",
    "2019-08-09,-184.4026,-5.19%,-79.7319,-2.24%,-104.6707,-2.94%,3.7405,0.11%,180.6621,5.08%,2774.75,-0.71%,8795.18,-1.39%",
    "2019-08-12,41.9085,1.24%,63.2379,1.87%,-21.3293,-0.63%,-53.6443,-1.59%,11.7357,0.35%,2814.99,1.45%,8978.52,2.08%",
    "2019-08-13,-120.0194,-3.8%,-39.0433,-1.23%,-80.9761,-2.56%,-10.1074,-0.32%,130.1268,4.12%,2797.26,-0.63%,8902.63,-0.85%",
    "2019-08-14,-46.7461,-1.24%,-3.3195,-0.09%,-43.4266,-1.15%,-16.8034,-0.45%,63.5495,1.69%,2808.91,0.42%,8966.47,0.72%",
    "2019-08-15,-30.6141,-0.83%,23.169,0.63%,-53.7831,-1.46%,-51.2038,-1.39%,81.8179,2.21%,2815.80,0.25%,9009.68,0.48%",
    "2019-08-16,19.0456,0.47%,49.0525,1.2%,-30.0069,-0.74%,-49.6944,-1.22%,30.6488,0.75%,2823.82,0.28%,9060.92,0.57%",
    "2019-08-19,98.7867,1.77%,93.2351,1.67%,5.5516,0.1%,-73.0441,-1.31%,-25.7425,-0.46%,2883.10,2.10%,9328.97,2.96%",
    "2019-08-20,-136.498,-2.7%,-38.739,-0.77%,-97.759,-1.94%,-12.2103,-0.24%,148.7083,2.94%,2880.00,-0.11%,9328.73,0.00%",
    "2019-08-21,-125.6106,-2.9%,-31.1132,-0.72%,-94.4974,-2.18%,-19.0136,-0.44%,144.6242,3.34%,2880.33,0.01%,9322.75,-0.06%",
    "2019-08-22,-106.5022,-2.5%,-25.8502,-0.61%,-80.652,-1.89%,-8.3797,-0.2%,114.882,2.69%,2883.44,0.11%,9350.56,0.30%",
    "2019-08-23,-105.2885,-2.3%,5.0208,0.11%,-110.3093,-2.41%,-43.6145,-0.95%,148.903,3.25%,2897.43,0.49%,9362.55,0.13%",
    "2019-08-26,-201.8276,-4.56%,-73.3198,-1.66%,-128.5078,-2.9%,6.5313,0.15%,195.2963,4.41%,2863.57,-1.17%,9270.39,-0.98%",
    "2019-08-27,21.5832,0.4%,58.4753,1.09%,-36.8921,-0.69%,-53.0913,-0.99%,31.5081,0.59%,2902.19,1.35%,9443.18,1.86%",
    "2019-08-28,-159.4743,-3.32%,-42.2225,-0.88%,-117.2518,-2.44%,-3.7122,-0.08%,163.1865,3.4%,2893.76,-0.29%,9414.00,-0.31%",
    "2019-08-29,-135.4122,-2.92%,-20.0892,-0.43%,-115.323,-2.49%,-15.2688,-0.33%,150.681,3.25%,2890.92,-0.10%,9398.47,-0.16%",
    "2019-08-30,-245.9584,-4.57%,-77.4729,-1.44%,-168.4855,-3.13%,-2.9824,-0.06%,248.9409,4.62%,2886.24,-0.16%,9365.68,-0.35%",
    "2019-09-02,75.5844,1.39%,97.5584,1.79%,-21.974,-0.4%,-79.1734,-1.46%,3.589,0.07%,2924.11,1.31%,9569.47,2.18%",
    "2019-09-03,-128.1942,-2.37%,-16.5308,-0.31%,-111.6634,-2.06%,2.1925,0.04%,126.0017,2.33%,2930.15,0.21%,9633.69,0.67%",
    "2019-09-04,-104.0492,-1.78%,-5.2684,-0.09%,-98.7808,-1.69%,-34.2416,-0.59%,138.2908,2.36%,2957.41,0.93%,9700.32,0.69%",
    "2019-09-05,7.4254,0.1%,91.2233,1.17%,-83.7979,-1.08%,-89.7403,-1.15%,82.3149,1.06%,2985.86,0.96%,9783.50,0.86%",
    "2019-09-06,-241.7034,-3.94%,-78.2682,-1.28%,-163.4352,-2.67%,11.4027,0.19%,230.3007,3.76%,2999.60,0.46%,9823.42,0.41%",
    "2019-09-09,37.2448,0.53%,93.6275,1.34%,-56.3827,-0.81%,-57.9,-0.83%,20.6552,0.3%,3024.74,0.84%,10001.93,1.82%",
    "2019-09-10,-283.9192,-4.16%,-130.7656,-1.92%,-153.1536,-2.25%,39.9575,0.59%,243.9617,3.58%,3021.20,-0.12%,9964.93,-0.37%",
    "2019-09-11,-318.5738,-5%,-150.0004,-2.35%,-168.5734,-2.64%,41.2991,0.65%,277.2747,4.35%,3008.81,-0.41%,9853.72,-1.12%",
    "2019-09-12,-101.9482,-1.95%,-3.7007,-0.07%,-98.2475,-1.88%,-29.0293,-0.55%,130.9775,2.5%,3031.24,0.75%,9919.80,0.67%",
    "2019-09-16,-177.8184,-3.13%,-53.9773,-0.95%,-123.8411,-2.18%,12.1614,0.21%,165.657,2.91%,3030.75,-0.02%,9918.09,-0.02%",
    "2019-09-17,-468.3262,-8.14%,-195.5862,-3.4%,-272.74,-4.74%,43.8028,0.76%,424.5234,7.38%,2978.12,-1.74%,9722.80,-1.97%",
    "2019-09-18,-163.6283,-3.44%,-30.0742,-0.63%,-133.5541,-2.81%,-1.7802,-0.04%,165.4085,3.47%,2985.66,0.25%,9753.31,0.31%",
    "2019-09-19,-50.7694,-1.05%,21.0081,0.43%,-71.7776,-1.48%,-27.0146,-0.56%,77.7841,1.61%,2999.28,0.46%,9852.20,1.01%",
    "2019-09-20,-187.8188,-3.61%,-44.9984,-0.86%,-142.8204,-2.74%,14.9862,0.29%,172.8327,3.32%,3006.45,0.24%,9881.25,0.29%",
    "2019-09-23,-252.1721,-5%,-72.5272,-1.44%,-179.6449,-3.56%,18.1384,0.36%,234.0337,4.64%,2977.08,-0.98%,9781.14,-1.01%",
    "2019-09-24,-99.1098,-1.84%,20.8278,0.39%,-119.9377,-2.23%,-29.2799,-0.54%,128.3897,2.38%,2985.34,0.28%,9811.38,0.31%",
    "2019-09-25,-362.511,-6.99%,-129.6815,-2.5%,-232.8295,-4.49%,36.9653,0.71%,325.5457,6.28%,2955.43,-1.00%,9671.06,-1.43%",
    "2019-09-26,-378.7623,-7.12%,-128.9518,-2.42%,-249.8105,-4.7%,17.8937,0.34%,360.8686,6.78%,2929.09,-0.89%,9464.84,-2.13%",
    "2019-09-27,-67.6999,-1.72%,17.6765,0.45%,-85.3764,-2.18%,-16.9521,-0.43%,84.652,2.16%,2932.17,0.11%,9548.96,0.89%",
    "2019-09-30,-191.5483,-5.66%,-52.4847,-1.55%,-139.0636,-4.11%,25.587,0.76%,165.9613,4.9%,2905.19,-0.92%,9446.24,-1.08%"]


def get_money_flow():
    flow = list()

    for day_data in MONEY_FLOW:
        arr = day_data.split(",")
        date, money = arr[0], float(arr[1])

        if date[0:7] == "2019-08":
            flow.append([date, money])

    return flow


def draw_stock(sh_stock, sz_stock):
    x_sh = sh_stock[0]
    y_sh = sh_stock[1]

    x_sz = sz_stock[0]
    y_sz = sz_stock[1]

    plt.figure(figsize=(10, 5))  # 设置画布大小
    plt.title(u'股市指数涨幅')  # 标题
    plt.xlabel(u'时间')  # x坐标
    plt.ylabel(u'涨幅')  # y坐标

    # 这里设置线宽、线型、线条颜色、点大小等参数
    plt.plot(x_sh, y_sh, label=u'上证指数', linewidth=1, color='green', marker='o',
             markerfacecolor='blue', markersize=3)
    plt.plot(x_sz, y_sz, label=u'深证成指', linewidth=1, color='red', marker='o',
             markerfacecolor='orange',
             markersize=3)

    # 每个数据点加标签
    for a, b in zip(x_sh, y_sh):
        plt.text(a, b, "%.2f%%" % b, ha='center', va='bottom', fontsize=10)

    for a, b in zip(x_sz, y_sz):
        plt.text(a, b, "%.2f%%" % b, ha='center', va='bottom', fontsize=10)
    # 只给最后一个点加标签
    # plt.text(x[-1], y1[-1], ("%s%%" % y1[-1]), ha='center', va='bottom', fontsize=10)

    plt.legend(loc='upper left')

    plt.savefig(OUT_PUT_DIR + 'stock.png', bbox_inches='tight')  # bbox_inches去掉两边留白
    plt.show()


def draw_money_flow(flow):
    x = [data[0][5:10].replace("-", "") for data in flow]
    y = [data[1] for data in flow]

    plt.figure(figsize=(10, 5))  # 设置画布大小
    plt.title(u'8月主力资金净流入')  # 标题
    plt.xlabel(u'时间')  # x坐标
    plt.ylabel(u'净额')  # y坐标

    # 这里设置线宽、线型、线条颜色、点大小等参数
    plt.plot(x, y, label=u'主力净流入(单位:亿元)', linewidth=1, color='green', marker='o',
             markerfacecolor='blue',
             markersize=3)

    # 每个数据点加标签
    for a, b in zip(x, y):
        plt.text(a, b, "%.2f" % b, ha='center', va='bottom', fontsize=10)

    plt.legend(loc='upper left')

    plt.savefig(OUT_PUT_DIR + 'money_flow.png', bbox_inches='tight')  # bbox_inches去掉两边留白
    plt.show()


if __name__ == "__main__":
    sh = get_sh_last_12_month_stock_exponential_changes()

    sz = get_sz_last_12_month_stock_exponential_changes()

    draw_stock(sh, sz)

    flow = get_money_flow()
    draw_money_flow(flow)
